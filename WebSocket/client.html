<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebSocket Long Message Test</title>
</head>
<body>
  <h2>WebSocket ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸</h2>

  <label>ğŸ‘¤ ì‚¬ìš©ì ID: </label>
  <input type="text" id="userIdInput" placeholder="userId ì…ë ¥" style="width:200px;">
  <button onclick="connect()">ğŸ”Œ Connect</button>
  <button onclick="disconnect()">âŒ Disconnect</button>
  <br><br>

  <input type="text" id="msgInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width:300px;">
  <button onclick="sendMessage()">ğŸ“¤ Send</button>
  <br><br>

  <button onclick="sendLongMessage()">ğŸ“¦ Send 5KB Message</button>
  <pre id="log" style="background:#eee; padding:10px; max-height:300px; overflow-y:scroll;"></pre>

  <script>
    let socket;

    function log(text) {
      const pre = document.getElementById('log');
      pre.textContent += text + "\n";
      pre.scrollTop = pre.scrollHeight;
    }

    function connect() {
      if (socket && socket.readyState === WebSocket.OPEN) {
        log("âš  ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŒ");
        return;
      }

      const userId = document.getElementById("userIdInput").value.trim();
      if (!userId) {
        log("â— userIdë¥¼ ì…ë ¥í•˜ì„¸ìš”");
        return;
      }

      socket = new WebSocket(`ws://localhost:5089/ws?userId=${encodeURIComponent(userId)}`);

      socket.onopen = () => log("âœ… ì—°ê²°ë¨");
      socket.onmessage = (event) => log("ğŸ“¨ ì„œë²„ ì‘ë‹µ: " + event.data);
      socket.onclose = () => log("âŒ ì—°ê²° ì¢…ë£Œ");
      socket.onerror = (err) => log("âš  ì˜¤ë¥˜ ë°œìƒ: " + err);
    }

    function disconnect() {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.close(1000, "Client disconnect");
        log("ğŸ›‘ ì—°ê²° ì¢…ë£Œ ìš”ì²­í•¨");
      } else {
        log("âš  ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŒ");
      }
    }

    function sendMessage() {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log("â— ì—°ê²°ë˜ì§€ ì•ŠìŒ");
        return;
      }

      const message = document.getElementById('msgInput').value;
      if (message.trim() === "") {
        log("âš  ë¹ˆ ë©”ì‹œì§€ëŠ” ì „ì†¡ë˜ì§€ ì•ŠìŒ");
        return;
      }

      socket.send(message);
      log("ğŸ“¤ ì „ì†¡: " + message);
    }

    function sendLongMessage() {
      if (!socket || socket.readyState !== WebSocket.OPEN) {
        log("â— ì—°ê²°ë˜ì§€ ì•ŠìŒ");
        return;
      }

      const longMessage = "X".repeat(5120);
      socket.send(longMessage);
      log("ğŸ“¤ 5KB ë©”ì‹œì§€ ì „ì†¡ë¨ (ê¸¸ì´: " + longMessage.length + ")");
    }
  </script>
</body>
</html>
